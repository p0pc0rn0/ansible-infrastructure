global:
  resolve_timeout: 5m
{% if smtp_server is defined %}
  smtp_smarthost: "{{ smtp_server }}"
{% endif %}
{% if smtp_user is defined %}
  smtp_auth_username: "{{ smtp_user }}"
{% endif %}
{% if smtp_password is defined %}
  smtp_auth_password: "{{ smtp_password }}"
{% endif %}
{% if alert_email is defined %}
  smtp_from: "{{ alert_email }}"
{% endif %}

route:
  receiver: default
  group_by: ['alertname', 'instance']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h
  routes:
    - match:
        severity: critical
      receiver: critical
    - match_re:
        severity: ^(warning|info)$
      receiver: default

receivers:
  - name: default
    email_configs:
      - to: "{{ alert_email | default('alerts@example.com') }}"
        send_resolved: true
{% if slack_webhook_url is defined %}
    slack_configs:
      - api_url: "{{ slack_webhook_url }}"
        send_resolved: true
        title: '{{ "{{" }} .CommonLabels.alertname {{ "}}" }}'
        text: >-
          {{ "{{" }} range .Alerts {{ "}}" }}*Severity:* {{ "{{" }} .Labels.severity | upper {{ "}}" }}
          *Summary:* {{ "{{" }} .Annotations.summary {{ "}}" }}
          *Description:* {{ "{{" }} .Annotations.description {{ "}}" }}
          {{ "{{" }} end {{ "}}" }}
{% endif %}

  - name: critical
    email_configs:
      - to: "{{ alert_email | default('alerts@example.com') }}"
        send_resolved: true

inhibit_rules:
  - source_match:
      severity: critical
    target_match:
      severity: warning
    equal: ['alertname', 'instance']
