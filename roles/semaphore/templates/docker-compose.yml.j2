version: "3.8"

services:
  postgres:
    image: postgres:15-alpine
    container_name: semaphore-postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: {{ semaphore_db_name }}
      POSTGRES_USER: {{ semaphore_db_user }}
      POSTGRES_PASSWORD: {{ semaphore_db_password }}
    volumes:
      - db-data:/var/lib/postgresql/data

  semaphore:
    image: semaphoreui/semaphore:{{ semaphore_version }}
    container_name: semaphore
    restart: unless-stopped
    depends_on:
      - postgres
    environment:
      SEMAPHORE_DB_DIALECT: postgres
      SEMAPHORE_DB_HOST: postgres
      SEMAPHORE_DB_PORT: "{{ semaphore_db_port }}"
      SEMAPHORE_DB: {{ semaphore_db_name }}
      SEMAPHORE_DB_USER: {{ semaphore_db_user }}
      SEMAPHORE_DB_PASS: {{ semaphore_db_password }}
      SEMAPHORE_ADMIN_NAME: {{ semaphore_admin_user }}
      SEMAPHORE_ADMIN_EMAIL: {{ semaphore_admin_email }}
      SEMAPHORE_ADMIN_PASSWORD: {{ semaphore_admin_password }}
      SEMAPHORE_ADMIN: {{ semaphore_admin_user }}
      SEMAPHORE_ACCESS_KEY_ENCRYPTION: "{{ semaphore_access_key_encryption }}"
      SEMAPHORE_PORT: "{{ semaphore_port }}"
      SEMAPHORE_PLAYBOOK_PATH: /home/semaphore/projects
      TZ: {{ semaphore_timezone }}
    ports:
      - "{{ semaphore_port }}:{{ semaphore_port }}"
    volumes:
      - config:/home/semaphore

volumes:
  db-data:
  config:
